<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Bootcamp > Week 2 > Day 2</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" type="image/x-icon" href="/swe/favicon.ico">
    <link rel="stylesheet" href="/swe/modest.css">
    <link rel="stylesheet" href="/swe/prism.css">
    <link rel="stylesheet" href="/swe/style.css">
  </head>
  <body>
    <h1>Bootcamp > Week 2 > Day 2</h1>
    <h2>Overview of the day</h2>
    <p>You have a data model for a restaurant ordering app. The problem is all the data is lost when your app stops. The data that makes the app persists only in memory, so when the process dies, so does the data. Today is about fixing that.</p>
    <h2>Lesson 1 - SQL</h2>
    <p>A Relational Database Management System (RDBMS) refers to a database that stores data using rows and columns. Structured Query Language (SQL) is used to query data in RDMSs.</p>
    <h2>Learning Objectives</h2>
    <ul>
      <li>Understand how to execute basic SQL statements</li>
    </ul>
    <h2>Assignment</h2>
    <p>Work through the <a href="https://www.w3schools.com/sql/sql_syntax.asp">W3Schools SQL Tutorial</a> up to and including the 'SQL Delete' lesson. This tutorial will enable you to understand how to create, read, update and delete (CRUD) data to / from a SQL database.</p>
    <p>Note that the <code>WHERE</code> clause is really important when querying. Often we want one record, or a set of records only. Use the <code>WHERE</code> clause to filter out the data you need.</p>
    <hr>
    <h2>Lesson 2 - SQLite3 Installation</h2>
    <p>SQLite3 is a lightweight SQL database. It is often used in embedded devices such as phones and games consoles.</p>
    <iframe src="https://docs.google.com/presentation/d/e/2PACX-1vQpmJ3NMHXf3v-uh4nT3O0keOjivstLweqSi7ZUbhvdFI1M6o4b2cDSFKFdz5YfakbewFyNjIdbrmBI/embed" width="776" height="467" allowfullscreen frameborder="0"></iframe>
    <h2>Learning Objectives</h2>
    <ul>
      <li>Connect to a database (in-memory)</li>
      <li>Execute CRUD statements on the database</li>
    </ul>
    <h2>Before we start</h2>
    <p>You need to install SQLite3.</p>
    <p>Execute <code>npm install sqlite3</code> in the directory where your <code>package.json</code> lives. If you get errors, try <code>npm install sqlite3@5.0.0</code> instead.</p>
    <p>If you still have errors, follow the instructions below (note these are Windows specific):</p>
    <ul>
      <li>Right click on VSCode and 'run as Administrator'. Navigate to the directory where your <code>package.json</code> file is and run <code>npm install --global --production windows-build-tools@4.0.0</code>.</li>
      <li>Close VSCode and run it again (this time not as administrator i.e. just double click on the icon). Execute <code>npm install sqlite3</code> in the directory where your <code>package.json</code> lives.</li>
    </ul>
    <p>To check your install is successful, paste this code into a file named <code>dbconnect.js</code>:</p>
    <pre><code class="language-js">const sqlite3 = require('sqlite3').verbose();

const db = new sqlite3.Database(':memory:', (err) => {
    if (err) {
      return console.error(err.message);
    }
    console.log('Connected to the in-memory SQlite database.');
  });
  
  // close the database connection
  db.close((err) => {
    if (err) {
      return console.error(err.message);
    }
    console.log('Close the database connection.');
  });
</code></pre>
    <p>run the file with <code>node dbconnect.js</code>. You should see the console logs appear. You have successfully connected to the sqlite in-memory database.</p>
    <h2>Lesson 3 - Using Node.js to run queries</h2>
    <p>In this lesson you need to recreate the <code>Customer</code> table you used in the <a href="https://www.w3schools.com/sql/sql_syntax.asp">W3Schools SQL Tutorial</a>. To simplify things, you can use an in-memory sqllite database.</p>
    <p>
      You may find the following links useful:
      <a href="https://www.sqlitetutorial.net/sqlite-nodejs/connect/">How to connect to a database</a>
      <a href="https://www.sqlitetutorial.net/sqlite-nodejs/insert/">How to insert data into a database</a>
      <a href="https://www.sqlitetutorial.net/sqlite-nodejs/query/">How to query data from a database</a>
    </p>
    <p>Here is an example of how to create a table and insert some rows into the table - please note this is very simplified and you will need to expand the code to include more columns.</p>
    <pre><code class="language-js">const sqlite3 = require('sqlite3').verbose();
const db = new sqlite3.Database(':memory:');

/**
 * Executes the SQL statements one at a time.
 * 
 * Please note that this does not have any error 
 * handling as yet.
 */
db.serialize(function() {
    db.run("CREATE TABLE CUSTOMERS (name TEXT)");

    const stmt = db.prepare("INSERT INTO CUSTOMERS VALUES (?)");

    for (let i = 0; i &#x3C; 10; i++) {
        stmt.run("Customer" + i);
    }

    stmt.finalize(); // releases any any internal resources 
                     // and deallocates any memory

    db.each("SELECT rowid AS id, name FROM CUSTOMERS", function(err, row) {
        console.log(row.id + ": " + row.name);
    });
});

db.close();
</code></pre>
    <h2>Assignment</h2>
    <ul>
      <li>Recreate the Customer table from your <a href="https://www.w3schools.com/sql/sql_syntax.asp">W3Schools SQL Tutorial</a> in an in-memory database</li>
      <li>Insert a number of rows into the table</li>
      <li>Query the table and print out the results</li>
      <li>Work out how to create a persistent database (i.e. one which is held on file rather than in-memory)</li>
    </ul>
    <h2>Lesson 4 - Restaurant tables</h2>
    <p>Your coach will provide you with a database design for a restaurant.</p>
    <h2>Assignment</h2>
    <ol>
      <li>Compose the SQL queries to do the following:
        <ul>
          <li>Create a database if one does not exist</li>
          <li>Implement the restaurants table</li>
          <li>Create an entry for a restaurant using "INSERT"</li>
          <li>Read back your restaurant using "SELECT"</li>
          <li>Update your restaurant using "UPDATE"</li>
          <li>Delete your restaurant using "DELETE"</li>
          <li>Use the WHERE clause to filter results</li>
        </ul>
      </li>
    </ol>
    <hr>
    <h2>Lesson 3 - JOIN tables</h2>
    <h2>Learning Objectives</h2>
    <ul>
      <li>Execute SQL commands</li>
      <li>Relate data using foreign keys</li>
    </ul>
    <h2>Before we start</h2>
    <ul>
      <li>Have you SQL queries for creating a table handy</li>
    </ul>
    <h2>Materials needed</h2>
    <ul>
      <li>Sqlite3</li>
    </ul>
    <h2>Lesson</h2>
    <p>It is great to be able to save a restaurant in our database. However our data model requires our restaurants to also have menu's associated with them. A restaurant might have many menus; for example a main menu, a set menu, a wine menu (wine list) and best of all the dessert menu! How can we store one or more menu items on the restaurant? We could make a new field on the restaurant table called 'menu'. But what would we do if we wanted to add a 2nd menu 'menu2'? And a third 'menu3'?</p>
    <p>No. The way this is done is by creating a separate table for the menus. When we create a row in the 'menus' table we create a special field to store the id of the restaurant we want the menu to be associated with. The convention is to call the field something like 'restaurant_id'. This is why databases that have tables like this are called 'relational databases'.</p>
    <p>How do we use the association we just created? When we query our database we are going to use the 'JOIN' keyword in SQL. Read the query below:</p>
    <pre><code class="language-sql">SELECT restaurants.name, menus.name 
FROM restaurants 
JOIN menus ON restaurants.id = menus.restaurant_id 
WHERE restaurants.id = 1;
</code></pre>
    <p>This statement selects the columns we want to retrieve from both tables; the restaurants table and the menus table. Notice now we have mixed fields coming from different tables, we have to name our columns with both the <code>table_name.field_name</code> i.e. <code>menus.name</code>. Use the <code>JOIN</code> keyword to make an association between the primary key from one table and the foreign key of another. In this example the primary key is the restaurants table id and the menus table restaurant_id. Can you explain why 'restaurant_id' is referred to as the foreign key?</p>
    <h2>Assignment</h2>
    <p>Write some JOIN statements that do the following:</p>
    <ul>
      <li>SELECT a restaurant, a menu and all the menu items using a JOIN statement</li>
      <li>SELECT all the restaurants with a count of the number of menus each restaurant has</li>
      <li>SELECT all the menus, with the total cost of all the menu items summed, and have the list in descending order (most expensive first)</li>
      <li>[extension activity] explore the documentation for SQL the <code>SUM</code>, <code>COUNT</code> and <code>GROUP BY</code> aggregate functions</li>
    </ul>
    <p>
      <a href="https://platform.whitehat.org.uk/apprentice/attendance-log/159">attendance log</a>
      <a href="/swe">main</a>|<a href="/swe/bootcamp/wk2/day1.html">prev</a>|<a href="/swe/bootcamp/wk2/day3.html">next</a>
    </p>
    <script src="/swe/prism.js"></script>
    <script src="/swe/tabbed-code-blocks.js"></script>
  </body>
</html>
